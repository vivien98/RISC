library std;
use std.standard.all;
library ieee;
use ieee.std_logic_1164.all;

entity stateMachine is
	port(bit1,bit0,t3,shift,carry,zero: in std_logic;state: in std_logic_vector(4 downto 0);opcode: in std_logic_vector(3 downto 0);next_state: out std_logic_vector(4 downto 0));
end entity;
architecture kahipan of stateMachine is

begin
SM : process (state,bit1,bit0,t3,shift,carry,zero,opcode) begin
	case state is
		when "00001" =>
			if (opcode = "0000" or opcode = "0010") then
				next_state <= "00010";
			elsif (opcode = "0101" or opcode = "0001" or opcode = "0100") then
				next_state <= "00101";
			elsif (opcode = "0011") then
				next_state <= "10011";
			elsif (opcode = "0110" or opcode = "0111") then
				next_state <= "00110";
			elsif (opcode = "1000" or opcode = "1001") then
				next_state <= "01000";
			end if;
		when "00010" =>
			if (opcode = "0000" or opcode = "0010") then
				if ((bit1 = '1' and bit0 = '0' and carry = '0')or(bit1 = '0' and bit0 = '1' and zero = '0')) then
					next_state <= "00001";
				elsif ((bit1 = '1' and bit0 = '0' and carry = '1')or(bit1 = '0' and bit0 = '1' and zero = '1') or (bit1 = '0' and bit0 = '0')) then
					next_state <= "00011";
				end if;
			elsif (opcode = "1100") then
				next_state <= "00011";
			elsif (opcode = "1001") then
				next_state <= "10010";
			end if;
		when "00011" =>
			if(opcode = "0000" or opcode = "0001" or opcode = "0010") then
				next_state <= "00100";
			elsif(opcode = "0100") then
				next_state <= "01000";
			elsif(opcode = "0101") then
				next_state <= "00110";
			elsif(opcode = "1100" and zero = '1') then
				next_state <= "01111";
			elsif(opcode = "1100" and zero = '0') then
				next_state <= "00001";
			end if;
		when "00110" =>
			if(opcode = "0101") then
				next_state <= "00111";
			elsif(opcode = "0110") then
				next_state <= "01001";
			elsif(opcode = "0111") then
				next_state <= "01101";
			end if;
		when "01001" =>
			if(shift = '1') then
				next_state <= "01010";
			elsif(shift = '0') then
				next_state <= "01011";
			end if;
		when "01100" =>
			if(opcode = "0110")then
				next_state <= "01001";
			elsif(opcode = "0111")then
				next_state <= "01101";
		when "01011" =>
			if(t3 = '1') then
				next_state <= "00001";
			elsif(t3 = '0') then
				next_state <= "01100";
			end if;
		when "01101" =>
			if(shift = '1') then
				next_state <= "01110";
			elsif(shift = '0') then
				next_state <= "01011";
			end if;
		when "10000" =>
			if(opcode = "1001")then
				next_state <= "00010";
			elsif(opcode = "1000")then
				next_state <= "10001";
			end if;
		when "00101" =>
			next_state <= "00011";
		when "01000" =>
			next_state <= "00100";
		when "01110" =>
			next_state <= "01011";
		when "01010" =>
			next_state <= "01100";
		when others =>
			next_state <= "00001";
	end case;	
end process SM;
end kahipan;






